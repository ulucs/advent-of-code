r:{0:"2021.kt/inputs/day",$:x}; wd:{-x_ x#'(1_)\ y}; til:{:[x>0;!:x;!:-:x]}

d1::({+/>':x};+/>':(+/)'-3_3#'(1_)\)@\: 0$r 1
d2::(*/ +/;*/ +/'{(x*y;y)}/(+\;{x})@' +:)@\: {(.+(`up`down`forward;(-1 0;1 0;0 1)))[x 0]*'0$x 1}+:(" "\)'r 2
d3::*/+{(+/)x*|(*/')(!#x)#\:+/2}''((1-)\%/(2*+/;#:)@\: 0$''r 3;@[;`a]'{{:[2>#x`b;.+:(`a`b;((,/x`a),x`b;()));.+:(`a`b;((x`a),**:;1_')@\: (x`b)@&(y=(#x`b)>2*+/*:'x`b)=*:'x`b)]}[;x]/.+:(`a`b;(();0$''r 3))}/:0 1)

d5::{(*:;til +/(::;1-2*0>)@\:-/|:)@/:\:+:0$''","\'@[x;0 2]}'(" "\'r "5ex")